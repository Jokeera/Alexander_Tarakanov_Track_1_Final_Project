schema: '2.0'
stages:
  prepare:
    cmd: python -m src.data.make_dataset
    deps:
    - path: data/raw/UCI_Credit_Card.csv
      hash: md5
      md5: 940b416bb13a9b24bb5c9e1589284005
      size: 2862995
    - path: src/data/make_dataset.py
      hash: md5
      md5: 2d8a9a89f4078ffa6447534ffb0d5888
      size: 4746
    params:
      params.yaml:
        data:
          raw_path: data/raw/UCI_Credit_Card.csv
          processed_path: data/processed/
          train_raw_path: data/processed/train.csv
          test_raw_path: data/processed/test.csv
          train_features_path: data/processed/train_features.csv
          test_features_path: data/processed/test_features.csv
          test_size: 0.2
          random_state: 42
          target: target
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: ea00658a1b5a54f88dd61e6ce9f75be0
      size: 696050
    - path: data/processed/train.csv
      hash: md5
      md5: 23ac3ff19a2b13e36efecd90d406a6c0
      size: 2782435
  features:
    cmd: python -m src.features.build_features
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: ea00658a1b5a54f88dd61e6ce9f75be0
      size: 696050
    - path: data/processed/train.csv
      hash: md5
      md5: 23ac3ff19a2b13e36efecd90d406a6c0
      size: 2782435
    - path: src/features/build_features.py
      hash: md5
      md5: 039fdd36ea782c95e747261c2bb2c9e0
      size: 4821
    params:
      params.yaml:
        features:
          age_bins:
          - 18
          - 30
          - 45
          - 60
          - 100
          age_labels:
          - young
          - middle
          - senior
          - elderly
    outs:
    - path: data/processed/test_features.csv
      hash: md5
      md5: 8973058a7607c6be3a95e565f1cde60f
      size: 1313209
    - path: data/processed/train_features.csv
      hash: md5
      md5: de9a73215339fb70258918714ebb6611
      size: 5254625
  train:
    cmd: python -m src.models.train
    deps:
    - path: data/processed/test_features.csv
      hash: md5
      md5: 8973058a7607c6be3a95e565f1cde60f
      size: 1313209
    - path: data/processed/train_features.csv
      hash: md5
      md5: de9a73215339fb70258918714ebb6611
      size: 5254625
    - path: src/models/pipeline.py
      hash: md5
      md5: 19dfa0d51d3924a975d2cf39d564e73a
      size: 3295
    - path: src/models/train.py
      hash: md5
      md5: b4fc1f1eb9d436b743797a4adde931a7
      size: 6351
    params:
      params.yaml:
        mlflow:
          tracking_uri: ./mlruns
          experiment_name: credit_scoring
        model:
          algorithm: gradient_boosting
          random_state: 42
          logistic_regression:
            penalty: l2
            C: 1.0
            max_iter: 1000
            solver: lbfgs
            class_weight: balanced
          random_forest:
            n_estimators: 50
            max_depth: 10
            min_samples_split: 20
            min_samples_leaf: 10
            class_weight: balanced
            random_state: 42
          gradient_boosting:
            n_estimators: 50
            learning_rate: 0.1
            max_depth: 5
            min_samples_split: 20
            min_samples_leaf: 10
            random_state: 42
        training:
          cv_folds: 3
          scoring: roc_auc
    outs:
    - path: models/metrics.json
      hash: md5
      md5: 7200a1c5fe8e0eb6017c5f0cb18687a6
      size: 168
    - path: models/model.pkl
      hash: md5
      md5: 7994c258127c70068ea3eabf24847cc4
      size: 565595
  drift:
    cmd: python -m src.monitoring.drift
    deps:
    - path: data/processed/test_features.csv
      hash: md5
      md5: 8973058a7607c6be3a95e565f1cde60f
      size: 1313209
    - path: data/processed/train_features.csv
      hash: md5
      md5: de9a73215339fb70258918714ebb6611
      size: 5254625
    - path: models/model.pkl
      hash: md5
      md5: 7994c258127c70068ea3eabf24847cc4
      size: 565595
    - path: src/monitoring/drift.py
      hash: md5
      md5: 481a03fd340acf2c5695c637f06e89a8
      size: 324
    params:
      params.yaml:
        monitoring:
          psi_threshold: 0.25
          buckets: 10
          features_to_monitor:
          - utilization_last
          - pay_delay_sum
          - pay_delay_max
          - bill_trend
          - pay_trend
          - bill_avg
          - pay_amt_avg
          - pay_to_bill_ratio
    outs:
    - path: models/drift_report.json
      hash: md5
      md5: 528045491d5639d960826af4e1e00f22
      size: 1298
