name: CI Pipeline

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  run-ci:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Install system deps
      run: |
        sudo apt-get update
        sudo apt-get install -y git-lfs

    - name: Install Python packages
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run DVC pipeline
      run: dvc repro --force

    - name: Run pytest
      run: pytest -q
name: ML Pipeline CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  run-ci:
    name: Run DVC + Tests
    runs-on: ubuntu-latest

    steps:
    # 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y git-lfs
        git lfs install

    # 4Ô∏è‚É£ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
    - name: Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        pip install dvc dvc-gdrive

    # 5Ô∏è‚É£ –í—ã—Ç—è–≥–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ DVC –ø–æ–¥–∫–ª—é—á–µ–Ω)
    - name: Pull DVC data
      run: |
        dvc pull || echo "DVC data not configured ‚Äî skipping üëç"

    # 6Ô∏è‚É£ –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ—Å—å pipeline
    - name: Run DVC pipeline
      run: |
        dvc repro --force

    # 7Ô∏è‚É£ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
    - name: Run tests
      run: |
        pytest -q --disable-warnings --maxfail=1

